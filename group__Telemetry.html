<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>3-phase PV router: Telemetry feature</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">3-phase PV router
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">Telemetry feature</div></div>
</div><!--header-->
<div class="contents">

<p>Functions used for data logging and external system communication.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTeleInfo.html">TeleInfo</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A class for managing and sending telemetry information in a structured frame format.  <a href="classTeleInfo.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga820a2f759b537f10c0543d9612390e8c" id="r_ga820a2f759b537f10c0543d9612390e8c"><td class="memItemLeft" align="right" valign="top">static constexpr size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga820a2f759b537f10c0543d9612390e8c">calcBufferSize</a> ()</td></tr>
<tr class="memdesc:ga820a2f759b537f10c0543d9612390e8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the total buffer size required for the telemetry frame.  <br /></td></tr>
<tr class="separator:ga820a2f759b537f10c0543d9612390e8c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa9a3eeacd11602f3385056e620652bb7" id="r_gaa9a3eeacd11602f3385056e620652bb7"><td class="memItemLeft" align="right" valign="top">static constexpr size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gaa9a3eeacd11602f3385056e620652bb7">lineSize</a> (size_t tagLen, size_t valueLen)</td></tr>
<tr class="memdesc:gaa9a3eeacd11602f3385056e620652bb7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the size of a single telemetry line in the frame.  <br /></td></tr>
<tr class="separator:gaa9a3eeacd11602f3385056e620652bb7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga85be36240113e579b00e944d4dbcd91a" id="r_ga85be36240113e579b00e944d4dbcd91a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga85be36240113e579b00e944d4dbcd91a">printForJSON</a> (const bool bOffPeak)</td></tr>
<tr class="memdesc:ga85be36240113e579b00e944d4dbcd91a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write telemetry data to Serial in JSON format.  <br /></td></tr>
<tr class="separator:ga85be36240113e579b00e944d4dbcd91a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae46d07fd4694c49e10360b5d79163443" id="r_gae46d07fd4694c49e10360b5d79163443"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gae46d07fd4694c49e10360b5d79163443">printForSerialText</a> ()</td></tr>
<tr class="memdesc:gae46d07fd4694c49e10360b5d79163443"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prints data logs to the Serial output in text format.  <br /></td></tr>
<tr class="separator:gae46d07fd4694c49e10360b5d79163443"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Functions used for data logging and external system communication. </p>
<p>This group includes functions that manage telemetry data collection and transmission. It supports integration with external systems like HomeAssistant, providing real-time data on power, voltage, temperature, and system status. Telemetry also includes diagnostic information.</p>
<dl class="section note"><dt>Note</dt><dd>The telemetry feature ensures that the system's performance and status can be monitored remotely. </dd></dl>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga820a2f759b537f10c0543d9612390e8c" name="ga820a2f759b537f10c0543d9612390e8c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga820a2f759b537f10c0543d9612390e8c">&#9670;&#160;</a></span>calcBufferSize()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static constexpr size_t calcBufferSize </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span><span class="mlabel static">static</span><span class="mlabel constexpr">constexpr</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculates the total buffer size required for the telemetry frame. </p>
<p>This function computes the size of the buffer needed to store the entire telemetry frame, including all tags, values, and formatting characters. The calculation takes into account the presence of optional features and system configuration.</p>
<dl class="section return"><dt>Returns</dt><dd>The total buffer size as a compile-time constant.</dd></dl>
<p>The buffer size is calculated as follows:</p><ul>
<li>1 byte for the start-of-text (STX) character.</li>
<li>1 line for the "P" tag (signed 6 digits) - power measurement.</li>
</ul>
<p>For multi-phase systems (<code>NO_OF_PHASES &gt; 1</code>):</p><ul>
<li><code>NO_OF_PHASES</code> lines for the "V1" to "Vn" tags (unsigned 5 digits each) - voltage measurements.</li>
<li><code>NO_OF_DUMPLOADS</code> lines for the "D1" to "Dn" tags (unsigned 3 digits each) - diversion rates.</li>
</ul>
<p>For single-phase systems:</p><ul>
<li>1 line for the "V" tag (unsigned 5 digits) - voltage measurement.</li>
<li>1 line for the "D" tag (unsigned 4 digits) - diverted power.</li>
<li>1 line for the "E" tag (unsigned 5 digits) - diverted energy.</li>
</ul>
<p>If relay diversion is enabled (<code>RELAY_DIVERSION</code>):</p><ul>
<li>1 line for the "R" tag (signed 6 digits) - mean power for relay diversion.</li>
<li><code>relays.get_size()</code> lines for the "R1" to "Rn" tags (1 digit each) - relay states.</li>
</ul>
<p>If temperature sensors are present (<code>TEMP_SENSOR_PRESENT</code>):</p><ul>
<li><code>temperatureSensing.get_size()</code> lines for the "T1" to "Tn" tags (4 digits each) - temperature readings.</li>
</ul>
<p>Common for all configurations:</p><ul>
<li>1 line for the "N" tag (unsigned 5 digits) - absence of diverted energy count.</li>
<li>1 line for the "S_MC" tag (unsigned 2 digits) - sample sets per mains cycle.</li>
<li>1 line for the "S" tag (unsigned 5 digits) - sample count.</li>
<li>1 byte for the end-of-text (ETX) character. </li>
</ul>

<p class="definition">Definition at line <a class="el" href="teleinfo_8h_source.html#l00091">91</a> of file <a class="el" href="teleinfo_8h_source.html">teleinfo.h</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__Telemetry_ga820a2f759b537f10c0543d9612390e8c_cgraph.png" border="0" usemap="#agroup__Telemetry_ga820a2f759b537f10c0543d9612390e8c_cgraph" alt=""/></div>
<map name="agroup__Telemetry_ga820a2f759b537f10c0543d9612390e8c_cgraph" id="agroup__Telemetry_ga820a2f759b537f10c0543d9612390e8c_cgraph">
<area shape="rect" title="Calculates the total buffer size required for the telemetry frame." alt="" coords="5,31,120,56"/>
<area shape="rect" href="group__Telemetry.html#gaa9a3eeacd11602f3385056e620652bb7" title="Calculates the size of a single telemetry line in the frame." alt="" coords="168,5,241,31"/>
<area shape="poly" title=" " alt="" coords="120,30,154,24,155,30,121,36"/>
<area shape="rect" href="types_8h.html#a694147b7171ec0b06bc8880dc100e756" title="Helper function to retrieve the dimension of a C&#45;array." alt="" coords="181,55,229,80"/>
<area shape="poly" title=" " alt="" coords="121,50,168,58,167,64,120,56"/>
</map>
</div>

</div>
</div>
<a id="gaa9a3eeacd11602f3385056e620652bb7" name="gaa9a3eeacd11602f3385056e620652bb7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa9a3eeacd11602f3385056e620652bb7">&#9670;&#160;</a></span>lineSize()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static constexpr size_t lineSize </td>
          <td>(</td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>tagLen</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>valueLen</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span><span class="mlabel static">static</span><span class="mlabel constexpr">constexpr</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculates the size of a single telemetry line in the frame. </p>
<p>This function computes the size of a single line in the telemetry frame, including the tag, value, and formatting characters. Each line consists of:</p><ul>
<li>1 byte for the Line Feed (LF) character.</li>
<li><code>tagLen</code> bytes for the tag.</li>
<li>1 byte for the Tab (TAB) character separating the tag and value.</li>
<li><code>valueLen</code> bytes for the value.</li>
<li>1 byte for the Tab (TAB) character separating the value and checksum.</li>
<li>1 byte for the checksum.</li>
<li>1 byte for the Carriage Return (CR) character.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tagLen</td><td>The length of the tag in bytes. </td></tr>
    <tr><td class="paramname">valueLen</td><td>The length of the value in bytes. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The total size of the line in bytes. </dd></dl>

<p class="definition">Definition at line <a class="el" href="teleinfo_8h_source.html#l00049">49</a> of file <a class="el" href="teleinfo_8h_source.html">teleinfo.h</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__Telemetry_gaa9a3eeacd11602f3385056e620652bb7_icgraph.png" border="0" usemap="#agroup__Telemetry_gaa9a3eeacd11602f3385056e620652bb7_icgraph" alt=""/></div>
<map name="agroup__Telemetry_gaa9a3eeacd11602f3385056e620652bb7_icgraph" id="agroup__Telemetry_gaa9a3eeacd11602f3385056e620652bb7_icgraph">
<area shape="rect" title="Calculates the size of a single telemetry line in the frame." alt="" coords="168,5,241,31"/>
<area shape="rect" href="group__Telemetry.html#ga820a2f759b537f10c0543d9612390e8c" title="Calculates the total buffer size required for the telemetry frame." alt="" coords="5,5,120,31"/>
<area shape="poly" title=" " alt="" coords="154,21,120,21,120,15,154,15"/>
</map>
</div>

</div>
</div>
<a id="ga85be36240113e579b00e944d4dbcd91a" name="ga85be36240113e579b00e944d4dbcd91a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga85be36240113e579b00e944d4dbcd91a">&#9670;&#160;</a></span>printForJSON()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void printForJSON </td>
          <td>(</td>
          <td class="paramtype">const bool</td>          <td class="paramname"><span class="paramname"><em>bOffPeak</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Write telemetry data to Serial in JSON format. </p>
<p>This function outputs telemetry data in a format compatible with JSON, including power, voltage, load states, temperature, and tariff information.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bOffPeak</td><td>Indicates whether the system is in an off-peak tariff period.</td></tr>
  </table>
  </dd>
</dl>
<ul>
<li>Outputs total power and phase-specific power.</li>
<li>Includes load ON percentages for each load.</li>
<li>Outputs temperature data if temperature sensing is enabled.</li>
<li>Includes tariff information if dual tariff is enabled. </li>
</ul>

<p class="definition">Definition at line <a class="el" href="utils_8h_source.html#l00196">196</a> of file <a class="el" href="utils_8h_source.html">utils.h</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__Telemetry_ga85be36240113e579b00e944d4dbcd91a_icgraph.png" border="0" usemap="#agroup__Telemetry_ga85be36240113e579b00e944d4dbcd91a_icgraph" alt=""/></div>
<map name="agroup__Telemetry_ga85be36240113e579b00e944d4dbcd91a_icgraph" id="agroup__Telemetry_ga85be36240113e579b00e944d4dbcd91a_icgraph">
<area shape="rect" title="Write telemetry data to Serial in JSON format." alt="" coords="253,5,357,31"/>
<area shape="rect" href="group__GeneralProcessing.html#gade56d6fce22a518b8feff1a150461f94" title="Prints or sends telemetry data logs based on the selected output format." alt="" coords="104,5,205,31"/>
<area shape="poly" title=" " alt="" coords="239,21,206,21,206,15,239,15"/>
<area shape="rect" href="group__GeneralProcessing.html#gafe461d27b9c48d5921c00d521181f12f" title="Main processor loop." alt="" coords="5,5,56,31"/>
<area shape="poly" title=" " alt="" coords="90,21,56,21,56,15,90,15"/>
</map>
</div>

</div>
</div>
<a id="gae46d07fd4694c49e10360b5d79163443" name="gae46d07fd4694c49e10360b5d79163443"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae46d07fd4694c49e10360b5d79163443">&#9670;&#160;</a></span>printForSerialText()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void printForSerialText </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Prints data logs to the Serial output in text format. </p>
<p>This function outputs telemetry data in a human-readable text format to the Serial output. It includes information about power, voltage, temperature, and system performance metrics.</p>
<ul>
<li>Prints total power, phase-specific power, and RMS voltage for each phase.</li>
<li>Includes temperature data if temperature sensing is enabled.</li>
<li>Outputs additional system metrics like the number of sample sets and absence of diverted energy count. </li>
</ul>

<p class="definition">Definition at line <a class="el" href="utils_8h_source.html#l00270">270</a> of file <a class="el" href="utils_8h_source.html">utils.h</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__Telemetry_gae46d07fd4694c49e10360b5d79163443_icgraph.png" border="0" usemap="#agroup__Telemetry_gae46d07fd4694c49e10360b5d79163443_icgraph" alt=""/></div>
<map name="agroup__Telemetry_gae46d07fd4694c49e10360b5d79163443_icgraph" id="agroup__Telemetry_gae46d07fd4694c49e10360b5d79163443_icgraph">
<area shape="rect" title="Prints data logs to the Serial output in text format." alt="" coords="253,5,389,31"/>
<area shape="rect" href="group__GeneralProcessing.html#gade56d6fce22a518b8feff1a150461f94" title="Prints or sends telemetry data logs based on the selected output format." alt="" coords="104,5,205,31"/>
<area shape="poly" title=" " alt="" coords="240,21,206,21,206,15,240,15"/>
<area shape="rect" href="group__GeneralProcessing.html#gafe461d27b9c48d5921c00d521181f12f" title="Main processor loop." alt="" coords="5,5,56,31"/>
<area shape="poly" title=" " alt="" coords="90,21,56,21,56,15,90,15"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2
</small></address>
</div><!-- doc-content -->
</body>
</html>
