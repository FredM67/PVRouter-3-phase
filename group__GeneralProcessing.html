<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>3-phase PV router: General Processing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">3-phase PV router
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">General Processing</div></div>
</div><!--header-->
<div class="contents">

<p>Functions and routines that handle general system processing tasks.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEWMA__average.html">EWMA_average&lt; A &gt;</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Implements an Exponentially Weighted Moving Average (EWMA).  <a href="classEWMA__average.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga31f3d562faae6b598324b56299d74f7d" id="r_ga31f3d562faae6b598324b56299d74f7d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga31f3d562faae6b598324b56299d74f7d">checkDiversionOnOff</a> ()</td></tr>
<tr class="memdesc:ga31f3d562faae6b598324b56299d74f7d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks and updates the diversion state based on the diversion pin.  <br /></td></tr>
<tr class="separator:ga31f3d562faae6b598324b56299d74f7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga749bd64aa252249f5d9c98668ef3200e" id="r_ga749bd64aa252249f5d9c98668ef3200e"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga749bd64aa252249f5d9c98668ef3200e">getOverrideBitmask</a> (const int16_t currentTemperature_x100)</td></tr>
<tr class="memdesc:ga749bd64aa252249f5d9c98668ef3200e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the combined bitmask of all active override pins and dual tariff forcing.  <br /></td></tr>
<tr class="separator:ga749bd64aa252249f5d9c98668ef3200e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga143b5ab1cc611c04c761240ce5687fdd" id="r_ga143b5ab1cc611c04c761240ce5687fdd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga143b5ab1cc611c04c761240ce5687fdd">handlePerSecondTasks</a> (bool &amp;bOffPeak, int16_t &amp;iTemperature_x100)</td></tr>
<tr class="memdesc:ga143b5ab1cc611c04c761240ce5687fdd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles tasks that need to be executed every second.  <br /></td></tr>
<tr class="separator:ga143b5ab1cc611c04c761240ce5687fdd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae473b1c0d80fe056d1fab9bdee38aca1" id="r_gae473b1c0d80fe056d1fab9bdee38aca1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gae473b1c0d80fe056d1fab9bdee38aca1">logLoadPriorities</a> ()</td></tr>
<tr class="memdesc:gae473b1c0d80fe056d1fab9bdee38aca1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prints the load priorities to the Serial output.  <br /></td></tr>
<tr class="separator:gae473b1c0d80fe056d1fab9bdee38aca1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafe461d27b9c48d5921c00d521181f12f" id="r_gafe461d27b9c48d5921c00d521181f12f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gafe461d27b9c48d5921c00d521181f12f">loop</a> ()</td></tr>
<tr class="memdesc:gafe461d27b9c48d5921c00d521181f12f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main processor loop.  <br /></td></tr>
<tr class="separator:gafe461d27b9c48d5921c00d521181f12f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6cceee9dcc5819acbee76f71dad833f7" id="r_ga6cceee9dcc5819acbee76f71dad833f7"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga6cceee9dcc5819acbee76f71dad833f7">proceedDualTariffLogic</a> ()</td></tr>
<tr class="memdesc:ga6cceee9dcc5819acbee76f71dad833f7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles dual tariff state transitions and priority rotation during off-peak periods.  <br /></td></tr>
<tr class="separator:ga6cceee9dcc5819acbee76f71dad833f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7018b73a8d20b89d8c80be9b8f9fa09f" id="r_ga7018b73a8d20b89d8c80be9b8f9fa09f"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga7018b73a8d20b89d8c80be9b8f9fa09f">proceedLoadPriorities</a> (const int16_t &amp;currentTemperature_x100)</td></tr>
<tr class="memdesc:ga7018b73a8d20b89d8c80be9b8f9fa09f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles load priority rotation and dual tariff state transitions.  <br /></td></tr>
<tr class="separator:ga7018b73a8d20b89d8c80be9b8f9fa09f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9b9428fd01019319970f27b88bb1cf33" id="r_ga9b9428fd01019319970f27b88bb1cf33"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga9b9428fd01019319970f27b88bb1cf33">proceedRotation</a> ()</td></tr>
<tr class="memdesc:ga9b9428fd01019319970f27b88bb1cf33"><td class="mdescLeft">&#160;</td><td class="mdescRight">Proceeds with load priority rotation.  <br /></td></tr>
<tr class="separator:ga9b9428fd01019319970f27b88bb1cf33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gade56d6fce22a518b8feff1a150461f94" id="r_gade56d6fce22a518b8feff1a150461f94"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gade56d6fce22a518b8feff1a150461f94">sendResults</a> (bool bOffPeak)</td></tr>
<tr class="memdesc:gade56d6fce22a518b8feff1a150461f94"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prints or sends telemetry data logs based on the selected output format.  <br /></td></tr>
<tr class="separator:gade56d6fce22a518b8feff1a150461f94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga09f681954987d95f85831ca82365f987" id="r_ga09f681954987d95f85831ca82365f987"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga09f681954987d95f85831ca82365f987">updatePowerAndVoltageData</a> ()</td></tr>
<tr class="memdesc:ga09f681954987d95f85831ca82365f987"><td class="mdescLeft">&#160;</td><td class="mdescRight">Updates power and voltage data for all phases.  <br /></td></tr>
<tr class="separator:ga09f681954987d95f85831ca82365f987"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Functions and routines that handle general system processing tasks. </p>
<p>This group includes functions that are not time-critical but are essential for the overall operation of the system. These tasks include monitoring system states, managing load priorities, and handling diversion logic.</p>
<ul>
<li>Functions in this group are typically called from the main loop or other non-interrupt contexts.</li>
<li>They ensure the system operates correctly and adapts to changing conditions. </li>
</ul>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga31f3d562faae6b598324b56299d74f7d" name="ga31f3d562faae6b598324b56299d74f7d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga31f3d562faae6b598324b56299d74f7d">&#9670;&#160;</a></span>checkDiversionOnOff()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void checkDiversionOnOff </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks and updates the diversion state based on the diversion pin. </p>
<p>This function monitors the state of the diversion pin and updates the global <code>b_diversionOff</code> flag accordingly. It also logs changes in the diversion state for debugging purposes if enabled.</p>
<ul>
<li>If the diversion pin is LOW, the diversion is considered OFF.</li>
<li>If the diversion pin is HIGH, the diversion is considered ON.</li>
<li>Debug messages are printed when the diversion state changes (if debugging is enabled). </li>
</ul>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00169">169</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__GeneralProcessing_ga31f3d562faae6b598324b56299d74f7d_cgraph.png" border="0" usemap="#agroup__GeneralProcessing_ga31f3d562faae6b598324b56299d74f7d_cgraph" alt=""/></div>
<map name="agroup__GeneralProcessing_ga31f3d562faae6b598324b56299d74f7d_cgraph" id="agroup__GeneralProcessing_ga31f3d562faae6b598324b56299d74f7d_cgraph">
<area shape="rect" title="Checks and updates the diversion state based on the diversion pin." alt="" coords="5,5,164,31"/>
<area shape="rect" href="utils__pins_8h.html#a410a7bdd300104398ce91797bd936cdb" title="Get the Pin State." alt="" coords="212,5,309,31"/>
<area shape="poly" title=" " alt="" coords="164,15,198,15,198,21,164,21"/>
<area shape="rect" href="utils__pins_8h.html#abaa54130a12679d0dcc0e7578e0e4d37" title="Read the specified bit." alt="" coords="357,5,432,31"/>
<area shape="poly" title=" " alt="" coords="309,15,343,15,343,21,309,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__GeneralProcessing_ga31f3d562faae6b598324b56299d74f7d_icgraph.png" border="0" usemap="#agroup__GeneralProcessing_ga31f3d562faae6b598324b56299d74f7d_icgraph" alt=""/></div>
<map name="agroup__GeneralProcessing_ga31f3d562faae6b598324b56299d74f7d_icgraph" id="agroup__GeneralProcessing_ga31f3d562faae6b598324b56299d74f7d_icgraph">
<area shape="rect" title="Checks and updates the diversion state based on the diversion pin." alt="" coords="323,5,481,31"/>
<area shape="rect" href="group__GeneralProcessing.html#ga143b5ab1cc611c04c761240ce5687fdd" title="Handles tasks that need to be executed every second." alt="" coords="104,5,275,31"/>
<area shape="poly" title=" " alt="" coords="309,21,275,21,275,15,309,15"/>
<area shape="rect" href="group__GeneralProcessing.html#gafe461d27b9c48d5921c00d521181f12f" title="Main processor loop." alt="" coords="5,5,56,31"/>
<area shape="poly" title=" " alt="" coords="90,21,57,21,57,15,90,15"/>
</map>
</div>

</div>
</div>
<a id="ga749bd64aa252249f5d9c98668ef3200e" name="ga749bd64aa252249f5d9c98668ef3200e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga749bd64aa252249f5d9c98668ef3200e">&#9670;&#160;</a></span>getOverrideBitmask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t getOverrideBitmask </td>
          <td>(</td>
          <td class="paramtype">const int16_t</td>          <td class="paramname"><span class="paramname"><em>currentTemperature_x100</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Gets the combined bitmask of all active override pins and dual tariff forcing. </p>
<p>This function calculates the complete override bitmask by combining external override pins with dual tariff automatic forcing. The bitwise OR operation automatically handles precedence where external overrides take priority over dual tariff forcing for the same pins.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">currentTemperature_x100</td><td>Current temperature multiplied by 100 (used for dual tariff logic). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Combined bitmask of all active overrides (external pins + dual tariff), 0 if no overrides are active.</dd></dl>
<ul>
<li>First checks all configured external override pins and sets corresponding bits.</li>
<li>Then applies dual tariff forcing using bitwise OR operation.</li>
<li>OR operation ensures external overrides take precedence (1|x = 1).</li>
<li>For pins without external overrides (0|x = x), dual tariff forcing is applied.</li>
<li>Function is called atomically to prevent race conditions with ISR. </li>
</ul>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00125">125</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__GeneralProcessing_ga749bd64aa252249f5d9c98668ef3200e_cgraph.png" border="0" usemap="#agroup__GeneralProcessing_ga749bd64aa252249f5d9c98668ef3200e_cgraph" alt=""/></div>
<map name="agroup__GeneralProcessing_ga749bd64aa252249f5d9c98668ef3200e_cgraph" id="agroup__GeneralProcessing_ga749bd64aa252249f5d9c98668ef3200e_cgraph">
<area shape="rect" title="Gets the combined bitmask of all active override pins and dual tariff forcing." alt="" coords="5,31,159,56"/>
<area shape="rect" href="group__DualTariff.html#ga09f688031c566f173bdfe18e65b0770a" title="Calculates the dual tariff forcing bitmask based on current conditions." alt="" coords="207,5,413,31"/>
<area shape="poly" title=" " alt="" coords="159,32,193,28,193,34,159,37"/>
<area shape="rect" href="utils__pins_8h.html#a410a7bdd300104398ce91797bd936cdb" title="Get the Pin State." alt="" coords="461,55,559,80"/>
<area shape="poly" title=" " alt="" coords="159,45,447,61,447,67,159,50"/>
<area shape="rect" href="utils__pins_8h.html#a23ed26b879b65f5ddf07facc1e4b18bc" title="Set the specified bit to 1." alt="" coords="477,5,543,31"/>
<area shape="poly" title=" " alt="" coords="413,15,463,15,463,21,413,21"/>
<area shape="poly" title=" " alt="" coords="363,28,449,50,447,55,362,33"/>
<area shape="rect" href="utils__pins_8h.html#abaa54130a12679d0dcc0e7578e0e4d37" title="Read the specified bit." alt="" coords="607,55,681,80"/>
<area shape="poly" title=" " alt="" coords="559,65,593,65,593,70,559,70"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__GeneralProcessing_ga749bd64aa252249f5d9c98668ef3200e_icgraph.png" border="0" usemap="#agroup__GeneralProcessing_ga749bd64aa252249f5d9c98668ef3200e_icgraph" alt=""/></div>
<map name="agroup__GeneralProcessing_ga749bd64aa252249f5d9c98668ef3200e_icgraph" id="agroup__GeneralProcessing_ga749bd64aa252249f5d9c98668ef3200e_icgraph">
<area shape="rect" title="Gets the combined bitmask of all active override pins and dual tariff forcing." alt="" coords="323,5,476,31"/>
<area shape="rect" href="group__GeneralProcessing.html#ga143b5ab1cc611c04c761240ce5687fdd" title="Handles tasks that need to be executed every second." alt="" coords="104,5,275,31"/>
<area shape="poly" title=" " alt="" coords="309,21,275,21,275,15,309,15"/>
<area shape="rect" href="group__GeneralProcessing.html#gafe461d27b9c48d5921c00d521181f12f" title="Main processor loop." alt="" coords="5,5,56,31"/>
<area shape="poly" title=" " alt="" coords="90,21,57,21,57,15,90,15"/>
</map>
</div>

</div>
</div>
<a id="ga143b5ab1cc611c04c761240ce5687fdd" name="ga143b5ab1cc611c04c761240ce5687fdd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga143b5ab1cc611c04c761240ce5687fdd">&#9670;&#160;</a></span>handlePerSecondTasks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void handlePerSecondTasks </td>
          <td>(</td>
          <td class="paramtype">bool &amp;</td>          <td class="paramname"><span class="paramname"><em>bOffPeak</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int16_t &amp;</td>          <td class="paramname"><span class="paramname"><em>iTemperature_x100</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles tasks that need to be executed every second. </p>
<p>This function performs various tasks that are triggered once per second, ensuring proper system operation and load management.</p>
<ul>
<li>Increments the absence of diverted energy count if no energy is being diverted.</li>
<li>Toggles the watchdog pin if the feature is enabled.</li>
<li>Checks and updates the diversion state.</li>
<li>Manages load priorities and overriding based on the current temperature.</li>
<li>Updates relay durations and proceeds with relay state transitions if relay diversion is enabled.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bOffPeak</td><td>Reference to the off-peak state flag. </td></tr>
    <tr><td class="paramname">iTemperature_x100</td><td>Current temperature multiplied by 100 (default to 0 if temperature sensing is disabled). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00448">448</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__GeneralProcessing_ga143b5ab1cc611c04c761240ce5687fdd_cgraph.png" border="0" usemap="#agroup__GeneralProcessing_ga143b5ab1cc611c04c761240ce5687fdd_cgraph" alt=""/></div>
<map name="agroup__GeneralProcessing_ga143b5ab1cc611c04c761240ce5687fdd_cgraph" id="agroup__GeneralProcessing_ga143b5ab1cc611c04c761240ce5687fdd_cgraph">
<area shape="rect" title="Handles tasks that need to be executed every second." alt="" coords="5,107,176,132"/>
<area shape="rect" href="group__GeneralProcessing.html#ga31f3d562faae6b598324b56299d74f7d" title="Checks and updates the diversion state based on the diversion pin." alt="" coords="459,132,617,157"/>
<area shape="poly" title=" " alt="" coords="176,121,445,137,445,142,176,127"/>
<area shape="rect" href="group__GeneralProcessing.html#ga749bd64aa252249f5d9c98668ef3200e" title="Gets the combined bitmask of all active override pins and dual tariff forcing." alt="" coords="229,81,382,107"/>
<area shape="poly" title=" " alt="" coords="176,107,215,102,216,107,177,112"/>
<area shape="rect" href="group__GeneralProcessing.html#ga7018b73a8d20b89d8c80be9b8f9fa09f" title="Handles load priority rotation and dual tariff state transitions." alt="" coords="224,208,387,233"/>
<area shape="poly" title=" " alt="" coords="120,130,266,200,264,204,118,135"/>
<area shape="rect" href="utils__pins_8h.html#aaec5db9d46ba784c4f16046e6deb6977" title="Toggle the specified pin." alt="" coords="264,7,347,32"/>
<area shape="poly" title=" " alt="" coords="118,104,263,36,266,40,120,109"/>
<area shape="rect" href="utils__pins_8h.html#a410a7bdd300104398ce91797bd936cdb" title="Get the Pin State." alt="" coords="705,132,803,157"/>
<area shape="poly" title=" " alt="" coords="618,142,691,142,691,147,618,147"/>
<area shape="rect" href="utils__pins_8h.html#abaa54130a12679d0dcc0e7578e0e4d37" title="Read the specified bit." alt="" coords="895,132,969,157"/>
<area shape="poly" title=" " alt="" coords="803,142,881,142,881,147,803,147"/>
<area shape="poly" title=" " alt="" coords="382,94,504,101,642,117,692,127,691,132,641,122,504,107,382,99"/>
<area shape="rect" href="group__DualTariff.html#ga09f688031c566f173bdfe18e65b0770a" title="Calculates the dual tariff forcing bitmask based on current conditions." alt="" coords="435,31,641,56"/>
<area shape="poly" title=" " alt="" coords="364,79,465,56,467,62,365,84"/>
<area shape="poly" title=" " alt="" coords="589,54,642,73,687,97,726,122,723,126,684,101,640,78,588,59"/>
<area shape="rect" href="utils__pins_8h.html#a23ed26b879b65f5ddf07facc1e4b18bc" title="Set the specified bit to 1." alt="" coords="721,5,787,31"/>
<area shape="poly" title=" " alt="" coords="641,29,707,21,708,26,642,34"/>
<area shape="poly" title=" " alt="" coords="386,207,641,166,691,156,692,161,642,171,387,212"/>
<area shape="rect" href="group__GeneralProcessing.html#ga6cceee9dcc5819acbee76f71dad833f7" title="Handles dual tariff state transitions and priority rotation during off&#45;peak periods." alt="" coords="453,233,623,259"/>
<area shape="poly" title=" " alt="" coords="387,227,439,233,438,238,387,232"/>
<area shape="rect" href="group__GeneralProcessing.html#ga9b9428fd01019319970f27b88bb1cf33" title="Proceeds with load priority rotation." alt="" coords="689,259,819,284"/>
<area shape="poly" title=" " alt="" coords="332,231,379,252,435,269,498,277,561,280,676,277,676,282,561,286,497,282,434,274,377,257,330,236"/>
<area shape="poly" title=" " alt="" coords="588,231,640,212,684,188,723,163,726,167,687,192,642,216,589,236"/>
<area shape="poly" title=" " alt="" coords="624,253,675,259,675,265,623,259"/>
<area shape="rect" href="group__GeneralProcessing.html#gae473b1c0d80fe056d1fab9bdee38aca1" title="Prints the load priorities to the Serial output." alt="" coords="867,259,997,284"/>
<area shape="poly" title=" " alt="" coords="819,269,853,269,853,274,819,274"/>
<area shape="poly" title=" " alt="" coords="347,16,435,15,707,15,707,21,435,21,347,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__GeneralProcessing_ga143b5ab1cc611c04c761240ce5687fdd_icgraph.png" border="0" usemap="#agroup__GeneralProcessing_ga143b5ab1cc611c04c761240ce5687fdd_icgraph" alt=""/></div>
<map name="agroup__GeneralProcessing_ga143b5ab1cc611c04c761240ce5687fdd_icgraph" id="agroup__GeneralProcessing_ga143b5ab1cc611c04c761240ce5687fdd_icgraph">
<area shape="rect" title="Handles tasks that need to be executed every second." alt="" coords="104,5,275,31"/>
<area shape="rect" href="group__GeneralProcessing.html#gafe461d27b9c48d5921c00d521181f12f" title="Main processor loop." alt="" coords="5,5,56,31"/>
<area shape="poly" title=" " alt="" coords="90,21,57,21,57,15,90,15"/>
</map>
</div>

</div>
</div>
<a id="gae473b1c0d80fe056d1fab9bdee38aca1" name="gae473b1c0d80fe056d1fab9bdee38aca1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae473b1c0d80fe056d1fab9bdee38aca1">&#9670;&#160;</a></span>logLoadPriorities()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void logLoadPriorities </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Prints the load priorities to the Serial output. </p>
<p>This function logs the current load priorities and states to the Serial output for debugging purposes. It provides a detailed view of the load configuration and their respective priorities.</p>
<ul>
<li>Each load's priority and state are printed in a human-readable format.</li>
<li>This function is only active when debugging is enabled (<code>ENABLE_DEBUG</code>). </li>
</ul>

<p class="definition">Definition at line <a class="el" href="utils_8h_source.html#l00484">484</a> of file <a class="el" href="utils_8h_source.html">utils.h</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__GeneralProcessing_gae473b1c0d80fe056d1fab9bdee38aca1_icgraph.png" border="0" usemap="#agroup__GeneralProcessing_gae473b1c0d80fe056d1fab9bdee38aca1_icgraph" alt=""/></div>
<map name="agroup__GeneralProcessing_gae473b1c0d80fe056d1fab9bdee38aca1_icgraph" id="agroup__GeneralProcessing_gae473b1c0d80fe056d1fab9bdee38aca1_icgraph">
<area shape="rect" title="Prints the load priorities to the Serial output." alt="" coords="929,56,1060,81"/>
<area shape="rect" href="group__GeneralProcessing.html#ga9b9428fd01019319970f27b88bb1cf33" title="Proceeds with load priority rotation." alt="" coords="752,31,881,56"/>
<area shape="poly" title=" " alt="" coords="915,60,881,55,882,50,916,55"/>
<area shape="rect" href="group__Initialization.html#ga4fc01d736fe50cf5b977f755b675f11d" title="Called once during startup." alt="" coords="787,80,846,105"/>
<area shape="poly" title=" " alt="" coords="916,82,846,91,846,86,915,77"/>
<area shape="rect" href="group__GeneralProcessing.html#ga6cceee9dcc5819acbee76f71dad833f7" title="Handles dual tariff state transitions and priority rotation during off&#45;peak periods." alt="" coords="533,5,704,31"/>
<area shape="poly" title=" " alt="" coords="738,36,704,32,704,26,739,31"/>
<area shape="rect" href="group__GeneralProcessing.html#ga7018b73a8d20b89d8c80be9b8f9fa09f" title="Handles load priority rotation and dual tariff state transitions." alt="" coords="323,31,485,56"/>
<area shape="poly" title=" " alt="" coords="738,46,486,46,486,41,738,41"/>
<area shape="poly" title=" " alt="" coords="520,32,486,36,485,31,519,27"/>
<area shape="rect" href="group__GeneralProcessing.html#ga143b5ab1cc611c04c761240ce5687fdd" title="Handles tasks that need to be executed every second." alt="" coords="104,31,275,56"/>
<area shape="poly" title=" " alt="" coords="309,46,275,46,275,41,309,41"/>
<area shape="rect" href="group__GeneralProcessing.html#gafe461d27b9c48d5921c00d521181f12f" title="Main processor loop." alt="" coords="5,31,56,56"/>
<area shape="poly" title=" " alt="" coords="90,46,57,46,57,41,90,41"/>
</map>
</div>

</div>
</div>
<a id="gafe461d27b9c48d5921c00d521181f12f" name="gafe461d27b9c48d5921c00d521181f12f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gafe461d27b9c48d5921c00d521181f12f">&#9670;&#160;</a></span>loop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void loop </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main processor loop. </p>
<p>This function handles non-time-critical tasks such as load management, telemetry updates, and temperature sensing. It processes ADC data through flags set by the ISR and ensures proper system operation.</p>
<ul>
<li>Executes tasks triggered by the <code>b_newMainsCycle</code> flag, which is set after every pair of ADC conversions.</li>
<li>Handles per-second tasks such as load priority management and diversion state updates.</li>
<li>Processes data logging events and updates power, voltage, and temperature data.</li>
<li>Sends telemetry results and updates relay states if relay diversion is enabled. </li>
</ul>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00492">492</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__GeneralProcessing_gafe461d27b9c48d5921c00d521181f12f_cgraph.png" border="0" usemap="#agroup__GeneralProcessing_gafe461d27b9c48d5921c00d521181f12f_cgraph" alt=""/></div>
<map name="agroup__GeneralProcessing_gafe461d27b9c48d5921c00d521181f12f_cgraph" id="agroup__GeneralProcessing_gafe461d27b9c48d5921c00d521181f12f_cgraph">
<area shape="rect" title="Main processor loop." alt="" coords="5,309,56,335"/>
<area shape="rect" href="group__GeneralProcessing.html#ga143b5ab1cc611c04c761240ce5687fdd" title="Handles tasks that need to be executed every second." alt="" coords="125,183,295,208"/>
<area shape="poly" title=" " alt="" coords="49,307,178,214,181,218,52,311"/>
<area shape="rect" href="main_8cpp.html#a90dc0c3192649d64ae885b62e6afa6e4" title="Processes temperature data from DS18B20 sensors." alt="" coords="117,284,303,309"/>
<area shape="poly" title=" " alt="" coords="56,316,107,309,107,314,57,321"/>
<area shape="rect" href="group__GeneralProcessing.html#gade56d6fce22a518b8feff1a150461f94" title="Prints or sends telemetry data logs based on the selected output format." alt="" coords="159,333,261,359"/>
<area shape="poly" title=" " alt="" coords="57,323,146,335,145,340,56,328"/>
<area shape="rect" href="group__GeneralProcessing.html#ga09f681954987d95f85831ca82365f987" title="Updates power and voltage data for all phases." alt="" coords="104,383,316,408"/>
<area shape="poly" title=" " alt="" coords="49,333,74,352,105,369,124,376,123,381,103,374,71,356,45,337"/>
<area shape="rect" href="group__GeneralProcessing.html#ga31f3d562faae6b598324b56299d74f7d" title="Checks and updates the diversion state based on the diversion pin." alt="" coords="599,5,757,31"/>
<area shape="poly" title=" " alt="" coords="225,180,283,137,322,113,363,92,419,70,477,53,585,29,586,34,478,58,420,75,365,96,325,117,286,141,228,185"/>
<area shape="rect" href="group__GeneralProcessing.html#ga749bd64aa252249f5d9c98668ef3200e" title="Gets the combined bitmask of all active override pins and dual tariff forcing." alt="" coords="369,107,522,132"/>
<area shape="poly" title=" " alt="" coords="249,180,391,134,393,139,251,185"/>
<area shape="rect" href="group__GeneralProcessing.html#ga7018b73a8d20b89d8c80be9b8f9fa09f" title="Handles load priority rotation and dual tariff state transitions." alt="" coords="364,183,527,208"/>
<area shape="poly" title=" " alt="" coords="296,193,350,193,350,198,296,198"/>
<area shape="rect" href="utils__pins_8h.html#aaec5db9d46ba784c4f16046e6deb6977" title="Toggle the specified pin." alt="" coords="637,309,719,335"/>
<area shape="poly" title=" " alt="" coords="272,205,390,233,527,269,630,302,628,307,526,274,389,238,270,211"/>
<area shape="rect" href="utils__pins_8h.html#a410a7bdd300104398ce91797bd936cdb" title="Get the Pin State." alt="" coords="885,107,982,132"/>
<area shape="poly" title=" " alt="" coords="725,28,782,48,896,98,894,103,780,52,724,33"/>
<area shape="rect" href="utils__pins_8h.html#abaa54130a12679d0dcc0e7578e0e4d37" title="Read the specified bit." alt="" coords="1113,107,1188,132"/>
<area shape="poly" title=" " alt="" coords="982,117,1100,117,1100,122,982,122"/>
<area shape="poly" title=" " alt="" coords="498,104,574,91,678,85,782,91,871,104,871,109,781,97,678,90,575,97,499,109"/>
<area shape="rect" href="group__DualTariff.html#ga09f688031c566f173bdfe18e65b0770a" title="Calculates the dual tariff forcing bitmask based on current conditions." alt="" coords="575,107,781,132"/>
<area shape="poly" title=" " alt="" coords="523,117,561,117,561,122,523,122"/>
<area shape="poly" title=" " alt="" coords="781,117,871,117,871,122,781,122"/>
<area shape="rect" href="utils__pins_8h.html#a23ed26b879b65f5ddf07facc1e4b18bc" title="Set the specified bit to 1." alt="" coords="900,296,967,321"/>
<area shape="poly" title=" " alt="" coords="701,130,741,157,783,193,798,211,807,226,816,241,831,256,859,275,888,289,886,294,856,279,828,260,812,244,802,229,793,214,779,197,737,162,698,134"/>
<area shape="poly" title=" " alt="" coords="526,180,781,141,871,126,872,132,782,146,527,186"/>
<area shape="rect" href="group__GeneralProcessing.html#ga6cceee9dcc5819acbee76f71dad833f7" title="Handles dual tariff state transitions and priority rotation during off&#45;peak periods." alt="" coords="593,208,763,233"/>
<area shape="poly" title=" " alt="" coords="527,202,579,207,578,213,527,207"/>
<area shape="rect" href="group__GeneralProcessing.html#ga9b9428fd01019319970f27b88bb1cf33" title="Proceeds with load priority rotation." alt="" coords="869,221,998,247"/>
<area shape="poly" title=" " alt="" coords="480,206,575,242,648,251,723,252,854,243,855,248,723,258,648,256,574,247,478,211"/>
<area shape="poly" title=" " alt="" coords="724,205,780,186,894,136,896,140,782,191,725,210"/>
<area shape="poly" title=" " alt="" coords="764,222,855,227,855,233,763,228"/>
<area shape="rect" href="group__GeneralProcessing.html#gae473b1c0d80fe056d1fab9bdee38aca1" title="Prints the load priorities to the Serial output." alt="" coords="1085,221,1216,247"/>
<area shape="poly" title=" " alt="" coords="998,231,1072,231,1072,237,998,237"/>
<area shape="poly" title=" " alt="" coords="719,317,886,308,886,314,720,323"/>
<area shape="rect" href="group__Telemetry.html#ga85be36240113e579b00e944d4dbcd91a" title="Write telemetry data to Serial in JSON format." alt="" coords="393,284,497,309"/>
<area shape="poly" title=" " alt="" coords="260,333,379,308,380,313,261,338"/>
<area shape="rect" href="group__Telemetry.html#gae46d07fd4694c49e10360b5d79163443" title="Prints data logs to the Serial output in text format." alt="" coords="377,333,513,359"/>
<area shape="poly" title=" " alt="" coords="261,343,364,343,364,349,261,349"/>
<area shape="rect" href="utils__rf_8h.html#ab5bc929f5a874ed02b16ed1d620d71cf" title="Send the logging data through RF." alt="" coords="392,383,499,408"/>
<area shape="poly" title=" " alt="" coords="261,354,379,379,378,384,260,359"/>
<area shape="rect" href="utils_8h.html#a1907e04bd551745d6acdaaf198bda73a" title="Sends telemetry data using the TeleInfo class." alt="" coords="371,432,520,457"/>
<area shape="poly" title=" " alt="" coords="262,350,290,357,317,369,333,381,342,394,351,407,365,418,377,424,374,429,363,423,347,410,338,397,329,385,315,374,288,362,260,355"/>
<area shape="rect" href="classTeleInfo.html#a4f418a8ad0164f7b10956c9186cdb345" title="Sends a telemetry value as an integer." alt="" coords="622,432,734,457"/>
<area shape="poly" title=" " alt="" coords="520,442,608,442,608,447,520,447"/>
<area shape="rect" href="classTeleInfo.html#a5db3eab02a4cc17cc5dc12bc081e3d58" title="Calculates the checksum for a portion of the buffer." alt="" coords="829,432,1037,457"/>
<area shape="poly" title=" " alt="" coords="734,442,815,442,815,447,734,447"/>
</map>
</div>

</div>
</div>
<a id="ga6cceee9dcc5819acbee76f71dad833f7" name="ga6cceee9dcc5819acbee76f71dad833f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6cceee9dcc5819acbee76f71dad833f7">&#9670;&#160;</a></span>proceedDualTariffLogic()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool proceedDualTariffLogic </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles dual tariff state transitions and priority rotation during off-peak periods. </p>
<p>This function manages dual tariff state detection and triggers priority rotation when transitioning to off-peak periods. The actual load forcing is handled in <a class="el" href="#ga749bd64aa252249f5d9c98668ef3200e" title="Gets the combined bitmask of all active override pins and dual tariff forcing.">getOverrideBitmask()</a>.</p>
<dl class="section return"><dt>Returns</dt><dd>true if the system is in a high tariff (on-peak) period. </dd>
<dd>
false if the system is in a low tariff (off-peak) period.</dd></dl>
<ul>
<li>Detects transitions between off-peak and on-peak periods using the dual tariff pin.</li>
<li>Triggers automatic priority rotation when entering off-peak period.</li>
<li>Logs transitions between tariff periods for debugging purposes.</li>
<li>Load forcing logic (including temperature conditions) is handled atomically in <a class="el" href="#ga749bd64aa252249f5d9c98668ef3200e" title="Gets the combined bitmask of all active override pins and dual tariff forcing.">getOverrideBitmask()</a>. </li>
</ul>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00233">233</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__GeneralProcessing_ga6cceee9dcc5819acbee76f71dad833f7_cgraph.png" border="0" usemap="#agroup__GeneralProcessing_ga6cceee9dcc5819acbee76f71dad833f7_cgraph" alt=""/></div>
<map name="agroup__GeneralProcessing_ga6cceee9dcc5819acbee76f71dad833f7_cgraph" id="agroup__GeneralProcessing_ga6cceee9dcc5819acbee76f71dad833f7_cgraph">
<area shape="rect" title="Handles dual tariff state transitions and priority rotation during off&#45;peak periods." alt="" coords="5,31,176,56"/>
<area shape="rect" href="utils__pins_8h.html#a410a7bdd300104398ce91797bd936cdb" title="Get the Pin State." alt="" coords="240,5,337,31"/>
<area shape="poly" title=" " alt="" coords="176,30,226,23,227,29,177,35"/>
<area shape="rect" href="group__GeneralProcessing.html#ga9b9428fd01019319970f27b88bb1cf33" title="Proceeds with load priority rotation." alt="" coords="224,55,353,80"/>
<area shape="poly" title=" " alt="" coords="177,51,211,55,210,61,176,56"/>
<area shape="rect" href="utils__pins_8h.html#abaa54130a12679d0dcc0e7578e0e4d37" title="Read the specified bit." alt="" coords="429,5,504,31"/>
<area shape="poly" title=" " alt="" coords="337,15,416,15,416,21,337,21"/>
<area shape="rect" href="group__GeneralProcessing.html#gae473b1c0d80fe056d1fab9bdee38aca1" title="Prints the load priorities to the Serial output." alt="" coords="401,55,532,80"/>
<area shape="poly" title=" " alt="" coords="354,65,388,65,388,70,354,70"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__GeneralProcessing_ga6cceee9dcc5819acbee76f71dad833f7_icgraph.png" border="0" usemap="#agroup__GeneralProcessing_ga6cceee9dcc5819acbee76f71dad833f7_icgraph" alt=""/></div>
<map name="agroup__GeneralProcessing_ga6cceee9dcc5819acbee76f71dad833f7_icgraph" id="agroup__GeneralProcessing_ga6cceee9dcc5819acbee76f71dad833f7_icgraph">
<area shape="rect" title="Handles dual tariff state transitions and priority rotation during off&#45;peak periods." alt="" coords="533,5,704,31"/>
<area shape="rect" href="group__GeneralProcessing.html#ga7018b73a8d20b89d8c80be9b8f9fa09f" title="Handles load priority rotation and dual tariff state transitions." alt="" coords="323,5,485,31"/>
<area shape="poly" title=" " alt="" coords="519,21,486,21,486,15,519,15"/>
<area shape="rect" href="group__GeneralProcessing.html#ga143b5ab1cc611c04c761240ce5687fdd" title="Handles tasks that need to be executed every second." alt="" coords="104,5,275,31"/>
<area shape="poly" title=" " alt="" coords="309,21,275,21,275,15,309,15"/>
<area shape="rect" href="group__GeneralProcessing.html#gafe461d27b9c48d5921c00d521181f12f" title="Main processor loop." alt="" coords="5,5,56,31"/>
<area shape="poly" title=" " alt="" coords="90,21,57,21,57,15,90,15"/>
</map>
</div>

</div>
</div>
<a id="ga7018b73a8d20b89d8c80be9b8f9fa09f" name="ga7018b73a8d20b89d8c80be9b8f9fa09f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga7018b73a8d20b89d8c80be9b8f9fa09f">&#9670;&#160;</a></span>proceedLoadPriorities()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool proceedLoadPriorities </td>
          <td>(</td>
          <td class="paramtype">const int16_t &amp;</td>          <td class="paramname"><span class="paramname"><em>currentTemperature_x100</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles load priority rotation and dual tariff state transitions. </p>
<p>This function manages load priority rotation behavior and dual tariff state detection based on the system configuration. It supports priority rotation via pin control, EmonESP control, or automatic rotation. Override logic is handled in <a class="el" href="#ga749bd64aa252249f5d9c98668ef3200e" title="Gets the combined bitmask of all active override pins and dual tariff forcing.">getOverrideBitmask()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">currentTemperature_x100</td><td>Current temperature multiplied by 100 (default to 0 if deactivated). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the system is in a high tariff (on-peak) period (only for dual tariff mode). </dd>
<dd>
false if the system is in a low tariff (off-peak) period or not in dual tariff mode.</dd></dl>
<ul>
<li>If dual tariff is enabled, it delegates to <code>proceedDualTariffLogic</code> for state transitions.</li>
<li>If EmonESP control is enabled, it handles load rotation based on the rotation pin state.</li>
<li>If priority rotation is set to auto, it rotates priorities after a defined period of inactivity.</li>
<li>Override logic (external pins + dual tariff forcing) is handled atomically in <a class="el" href="#ga749bd64aa252249f5d9c98668ef3200e" title="Gets the combined bitmask of all active override pins and dual tariff forcing.">getOverrideBitmask()</a>. </li>
</ul>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00281">281</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__GeneralProcessing_ga7018b73a8d20b89d8c80be9b8f9fa09f_cgraph.png" border="0" usemap="#agroup__GeneralProcessing_ga7018b73a8d20b89d8c80be9b8f9fa09f_cgraph" alt=""/></div>
<map name="agroup__GeneralProcessing_ga7018b73a8d20b89d8c80be9b8f9fa09f_cgraph" id="agroup__GeneralProcessing_ga7018b73a8d20b89d8c80be9b8f9fa09f_cgraph">
<area shape="rect" title="Handles load priority rotation and dual tariff state transitions." alt="" coords="5,29,168,55"/>
<area shape="rect" href="utils__pins_8h.html#a410a7bdd300104398ce91797bd936cdb" title="Get the Pin State." alt="" coords="451,5,548,31"/>
<area shape="poly" title=" " alt="" coords="140,27,216,14,301,11,387,14,437,14,437,20,387,19,301,16,216,19,140,32"/>
<area shape="rect" href="group__GeneralProcessing.html#ga6cceee9dcc5819acbee76f71dad833f7" title="Handles dual tariff state transitions and priority rotation during off&#45;peak periods." alt="" coords="216,29,387,55"/>
<area shape="poly" title=" " alt="" coords="168,39,202,39,202,45,168,45"/>
<area shape="rect" href="group__GeneralProcessing.html#ga9b9428fd01019319970f27b88bb1cf33" title="Proceeds with load priority rotation." alt="" coords="435,55,564,80"/>
<area shape="poly" title=" " alt="" coords="140,52,216,65,323,70,421,69,421,74,323,75,216,70,140,57"/>
<area shape="rect" href="utils__pins_8h.html#abaa54130a12679d0dcc0e7578e0e4d37" title="Read the specified bit." alt="" coords="640,5,715,31"/>
<area shape="poly" title=" " alt="" coords="548,15,626,15,626,21,548,21"/>
<area shape="poly" title=" " alt="" coords="387,29,437,23,437,28,388,34"/>
<area shape="poly" title=" " alt="" coords="388,50,422,55,421,60,387,56"/>
<area shape="rect" href="group__GeneralProcessing.html#gae473b1c0d80fe056d1fab9bdee38aca1" title="Prints the load priorities to the Serial output." alt="" coords="612,55,743,80"/>
<area shape="poly" title=" " alt="" coords="564,65,598,65,598,70,564,70"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__GeneralProcessing_ga7018b73a8d20b89d8c80be9b8f9fa09f_icgraph.png" border="0" usemap="#agroup__GeneralProcessing_ga7018b73a8d20b89d8c80be9b8f9fa09f_icgraph" alt=""/></div>
<map name="agroup__GeneralProcessing_ga7018b73a8d20b89d8c80be9b8f9fa09f_icgraph" id="agroup__GeneralProcessing_ga7018b73a8d20b89d8c80be9b8f9fa09f_icgraph">
<area shape="rect" title="Handles load priority rotation and dual tariff state transitions." alt="" coords="323,5,485,31"/>
<area shape="rect" href="group__GeneralProcessing.html#ga143b5ab1cc611c04c761240ce5687fdd" title="Handles tasks that need to be executed every second." alt="" coords="104,5,275,31"/>
<area shape="poly" title=" " alt="" coords="309,21,275,21,275,15,309,15"/>
<area shape="rect" href="group__GeneralProcessing.html#gafe461d27b9c48d5921c00d521181f12f" title="Main processor loop." alt="" coords="5,5,56,31"/>
<area shape="poly" title=" " alt="" coords="90,21,57,21,57,15,90,15"/>
</map>
</div>

</div>
</div>
<a id="ga9b9428fd01019319970f27b88bb1cf33" name="ga9b9428fd01019319970f27b88bb1cf33"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga9b9428fd01019319970f27b88bb1cf33">&#9670;&#160;</a></span>proceedRotation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void proceedRotation </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Proceeds with load priority rotation. </p>
<p>This function triggers the rotation of load priorities and waits until the rotation is completed. It ensures that the new load priorities are logged after the rotation.</p>
<ul>
<li>Sets the <code>b_reOrderLoads</code> flag to initiate the rotation process.</li>
<li>Waits in a loop until the rotation is completed by the ISR.</li>
<li>Logs the updated load priorities after the rotation. </li>
</ul>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00202">202</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__GeneralProcessing_ga9b9428fd01019319970f27b88bb1cf33_cgraph.png" border="0" usemap="#agroup__GeneralProcessing_ga9b9428fd01019319970f27b88bb1cf33_cgraph" alt=""/></div>
<map name="agroup__GeneralProcessing_ga9b9428fd01019319970f27b88bb1cf33_cgraph" id="agroup__GeneralProcessing_ga9b9428fd01019319970f27b88bb1cf33_cgraph">
<area shape="rect" title="Proceeds with load priority rotation." alt="" coords="5,5,135,31"/>
<area shape="rect" href="group__GeneralProcessing.html#gae473b1c0d80fe056d1fab9bdee38aca1" title="Prints the load priorities to the Serial output." alt="" coords="183,5,313,31"/>
<area shape="poly" title=" " alt="" coords="135,15,169,15,169,21,135,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__GeneralProcessing_ga9b9428fd01019319970f27b88bb1cf33_icgraph.png" border="0" usemap="#agroup__GeneralProcessing_ga9b9428fd01019319970f27b88bb1cf33_icgraph" alt=""/></div>
<map name="agroup__GeneralProcessing_ga9b9428fd01019319970f27b88bb1cf33_icgraph" id="agroup__GeneralProcessing_ga9b9428fd01019319970f27b88bb1cf33_icgraph">
<area shape="rect" title="Proceeds with load priority rotation." alt="" coords="752,31,881,56"/>
<area shape="rect" href="group__GeneralProcessing.html#ga6cceee9dcc5819acbee76f71dad833f7" title="Handles dual tariff state transitions and priority rotation during off&#45;peak periods." alt="" coords="533,5,704,31"/>
<area shape="poly" title=" " alt="" coords="738,36,704,32,704,26,739,31"/>
<area shape="rect" href="group__GeneralProcessing.html#ga7018b73a8d20b89d8c80be9b8f9fa09f" title="Handles load priority rotation and dual tariff state transitions." alt="" coords="323,31,485,56"/>
<area shape="poly" title=" " alt="" coords="738,46,486,46,486,41,738,41"/>
<area shape="poly" title=" " alt="" coords="520,32,486,36,485,31,519,27"/>
<area shape="rect" href="group__GeneralProcessing.html#ga143b5ab1cc611c04c761240ce5687fdd" title="Handles tasks that need to be executed every second." alt="" coords="104,31,275,56"/>
<area shape="poly" title=" " alt="" coords="309,46,275,46,275,41,309,41"/>
<area shape="rect" href="group__GeneralProcessing.html#gafe461d27b9c48d5921c00d521181f12f" title="Main processor loop." alt="" coords="5,31,56,56"/>
<area shape="poly" title=" " alt="" coords="90,46,57,46,57,41,90,41"/>
</map>
</div>

</div>
</div>
<a id="gade56d6fce22a518b8feff1a150461f94" name="gade56d6fce22a518b8feff1a150461f94"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gade56d6fce22a518b8feff1a150461f94">&#9670;&#160;</a></span>sendResults()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void sendResults </td>
          <td>(</td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>bOffPeak</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Prints or sends telemetry data logs based on the selected output format. </p>
<p>This function handles the transmission of telemetry data in various formats, such as human-readable text, IoT telemetry, or JSON format. It also ensures that the first incomplete datalogging event is skipped during startup.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bOffPeak</td><td>Indicates whether the system is in an off-peak tariff period.</td></tr>
  </table>
  </dd>
</dl>
<ul>
<li>If RF communication is enabled, it sends RF data.</li>
<li>Depending on the <code>SERIAL_OUTPUT_TYPE</code>, it prints data in text format, sends telemetry data, or outputs data in JSON format.</li>
<li>Skips the first datalogging event during startup to avoid incomplete data. </li>
</ul>

<p class="definition">Definition at line <a class="el" href="utils_8h_source.html#l00443">443</a> of file <a class="el" href="utils_8h_source.html">utils.h</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__GeneralProcessing_gade56d6fce22a518b8feff1a150461f94_cgraph.png" border="0" usemap="#agroup__GeneralProcessing_gade56d6fce22a518b8feff1a150461f94_cgraph" alt=""/></div>
<map name="agroup__GeneralProcessing_gade56d6fce22a518b8feff1a150461f94_cgraph" id="agroup__GeneralProcessing_gade56d6fce22a518b8feff1a150461f94_cgraph">
<area shape="rect" title="Prints or sends telemetry data logs based on the selected output format." alt="" coords="5,80,107,105"/>
<area shape="rect" href="group__Telemetry.html#ga85be36240113e579b00e944d4dbcd91a" title="Write telemetry data to Serial in JSON format." alt="" coords="177,5,281,31"/>
<area shape="poly" title=" " alt="" coords="78,78,154,40,171,33,173,38,156,44,80,82"/>
<area shape="rect" href="group__Telemetry.html#gae46d07fd4694c49e10360b5d79163443" title="Prints data logs to the Serial output in text format." alt="" coords="161,55,297,80"/>
<area shape="poly" title=" " alt="" coords="106,83,147,77,148,82,107,88"/>
<area shape="rect" href="utils__rf_8h.html#ab5bc929f5a874ed02b16ed1d620d71cf" title="Send the logging data through RF." alt="" coords="176,104,283,129"/>
<area shape="poly" title=" " alt="" coords="107,97,163,105,162,110,106,102"/>
<area shape="rect" href="utils_8h.html#a1907e04bd551745d6acdaaf198bda73a" title="Sends telemetry data using the TeleInfo class." alt="" coords="155,153,304,179"/>
<area shape="poly" title=" " alt="" coords="82,103,156,138,176,146,174,151,154,143,80,108"/>
<area shape="rect" href="classTeleInfo.html#a4f418a8ad0164f7b10956c9186cdb345" title="Sends a telemetry value as an integer." alt="" coords="352,153,464,179"/>
<area shape="poly" title=" " alt="" coords="304,163,338,163,338,169,304,169"/>
<area shape="rect" href="classTeleInfo.html#a5db3eab02a4cc17cc5dc12bc081e3d58" title="Calculates the checksum for a portion of the buffer." alt="" coords="512,153,720,179"/>
<area shape="poly" title=" " alt="" coords="464,163,498,163,498,169,464,169"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__GeneralProcessing_gade56d6fce22a518b8feff1a150461f94_icgraph.png" border="0" usemap="#agroup__GeneralProcessing_gade56d6fce22a518b8feff1a150461f94_icgraph" alt=""/></div>
<map name="agroup__GeneralProcessing_gade56d6fce22a518b8feff1a150461f94_icgraph" id="agroup__GeneralProcessing_gade56d6fce22a518b8feff1a150461f94_icgraph">
<area shape="rect" title="Prints or sends telemetry data logs based on the selected output format." alt="" coords="104,5,205,31"/>
<area shape="rect" href="group__GeneralProcessing.html#gafe461d27b9c48d5921c00d521181f12f" title="Main processor loop." alt="" coords="5,5,56,31"/>
<area shape="poly" title=" " alt="" coords="90,21,56,21,56,15,90,15"/>
</map>
</div>

</div>
</div>
<a id="ga09f681954987d95f85831ca82365f987" name="ga09f681954987d95f85831ca82365f987"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga09f681954987d95f85831ca82365f987">&#9670;&#160;</a></span>updatePowerAndVoltageData()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void updatePowerAndVoltageData </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Updates power and voltage data for all phases. </p>
<p>This function calculates the power and voltage for each phase based on the accumulated data during the datalogging period. It also updates the total power.</p>
<ul>
<li>Computes the power for each phase using the accumulated power data and calibration factors.</li>
<li>Calculates the RMS voltage for each phase using the accumulated voltage squared data.</li>
<li>Updates the total power by summing the power of all phases. </li>
</ul>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00372">372</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__GeneralProcessing_ga09f681954987d95f85831ca82365f987_icgraph.png" border="0" usemap="#agroup__GeneralProcessing_ga09f681954987d95f85831ca82365f987_icgraph" alt=""/></div>
<map name="agroup__GeneralProcessing_ga09f681954987d95f85831ca82365f987_icgraph" id="agroup__GeneralProcessing_ga09f681954987d95f85831ca82365f987_icgraph">
<area shape="rect" title="Updates power and voltage data for all phases." alt="" coords="104,5,316,31"/>
<area shape="rect" href="group__GeneralProcessing.html#gafe461d27b9c48d5921c00d521181f12f" title="Main processor loop." alt="" coords="5,5,56,31"/>
<area shape="poly" title=" " alt="" coords="90,21,56,21,56,15,90,15"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2
</small></address>
</div><!-- doc-content -->
</body>
</html>
